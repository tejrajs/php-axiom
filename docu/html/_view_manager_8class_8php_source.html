<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Axiom: libraries/ViewManager.class.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>libraries/ViewManager.class.php</h1><a href="_view_manager_8class_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00020"></a><a class="code" href="class_view_manager.html">00020</a> <span class="keyword">class </span><a class="code" href="class_view_manager.html">ViewManager</a> {
<a name="l00021"></a>00021     
<a name="l00027"></a><a class="code" href="class_view_manager.html#a8fed3b3735bfd480d651f9022268de5c">00027</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="class_view_manager.html#a8fed3b3735bfd480d651f9022268de5c">$_config</a> = array();
<a name="l00028"></a>00028     
<a name="l00033"></a><a class="code" href="class_view_manager.html#a088c6d11c2d1a8b6b27ac08308fee8ce">00033</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="class_view_manager.html#a088c6d11c2d1a8b6b27ac08308fee8ce">$_layout_vars</a> = array();
<a name="l00034"></a>00034     
<a name="l00039"></a><a class="code" href="class_view_manager.html#a870ed2111eda2268c8e120f45df28834">00039</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="class_view_manager.html#a870ed2111eda2268c8e120f45df28834">$_response</a>;
<a name="l00040"></a>00040     
<a name="l00047"></a><a class="code" href="class_view_manager.html#a72cdbc93b6a6fc8938035e17e42ffb7d">00047</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#a72cdbc93b6a6fc8938035e17e42ffb7d">load</a> ($controller, $action) {
<a name="l00048"></a>00048         <a class="code" href="class_view_manager.html#a24a295ed70901f23f3ea9ea74d8d2851">self::setContentType</a>($format = ($f = self::$_response-&gt;getOutputFormat()) ? $f : self::$_config[<span class="stringliteral">&#39;default_output_format&#39;</span>]);
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         $section = lcfirst(str_replace(<span class="stringliteral">&#39;Controller&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $controller));
<a name="l00051"></a>00051         $view = ($v = self::$_response-&gt;getResponseView()) ? $v : $action;
<a name="l00052"></a>00052         
<a name="l00053"></a>00053         <span class="keywordflow">if</span> (file_exists($__filename = realpath(self::$_config[<span class="stringliteral">&#39;view_path&#39;</span>]) . <span class="stringliteral">&quot;/{$section}/{$view}.{$format}.php&quot;</span>)) { }
<a name="l00054"></a>00054         elseif (file_exists($__filename = realpath(self::$_config[<span class="stringliteral">&#39;default_view_path&#39;</span>]) . <span class="stringliteral">&quot;/{$section}/{$view}.{$format}.php&quot;</span>)) { }
<a name="l00055"></a>00055         <span class="keywordflow">else</span> <span class="keywordflow">return</span>;
<a name="l00056"></a>00056         
<a name="l00057"></a>00057         <span class="keywordflow">try</span> {
<a name="l00058"></a>00058             ob_start();
<a name="l00059"></a>00059             
<a name="l00060"></a>00060             extract(self::$_layout_vars);
<a name="l00061"></a>00061             extract(self::$_response-&gt;getResponseVars());
<a name="l00062"></a>00062             <span class="keywordflow">foreach</span> (self::$_response-&gt;getMessages() as $level =&gt; $message) {
<a name="l00063"></a>00063                 ${$level} = $message;
<a name="l00064"></a>00064             }
<a name="l00065"></a>00065             include $__filename;
<a name="l00066"></a>00066             
<a name="l00067"></a>00067             ${self::$_config[<span class="stringliteral">&#39;layout_content_var&#39;</span>]} = ob_get_contents();
<a name="l00068"></a>00068             ob_end_clean();
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070         <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00071"></a>00071             ob_end_clean();
<a name="l00072"></a>00072             <a class="code" href="class_view_manager.html#a72cdbc93b6a6fc8938035e17e42ffb7d">Router::load</a>(<span class="stringliteral">&#39;ErrorController&#39;</span>, <span class="stringliteral">&#39;http500&#39;</span>);
<a name="l00073"></a>00073             <span class="keywordflow">return</span>;
<a name="l00074"></a>00074         }
<a name="l00075"></a>00075         
<a name="l00076"></a>00076         include <a class="code" href="class_view_manager.html#ab4ddb76e22cf9c96cd60b794aee9d1da">self::getLayoutFilePath</a>($format);
<a name="l00077"></a>00077     }
<a name="l00078"></a>00078     
<a name="l00085"></a><a class="code" href="class_view_manager.html#a24a295ed70901f23f3ea9ea74d8d2851">00085</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#a24a295ed70901f23f3ea9ea74d8d2851">setContentType</a> ($output_format = null) {
<a name="l00086"></a>00086         <span class="keywordflow">if</span> (!$output_format)
<a name="l00087"></a>00087             $output_format = self::$_config[<span class="stringliteral">&#39;default_output_format&#39;</span>];
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="keywordflow">switch</span> (strtolower($output_format)) {
<a name="l00090"></a>00090             <span class="keywordflow">case</span> <span class="stringliteral">&#39;html&#39;</span>: header(<span class="stringliteral">&#39;Content-Type: text/html; charset=UTF-8&#39;</span>); <span class="keywordflow">break</span>;
<a name="l00091"></a>00091             <span class="keywordflow">case</span> <span class="stringliteral">&#39;json&#39;</span>: header(<span class="stringliteral">&#39;Content-Type: application/json; charset=UTF-8&#39;</span>); <span class="keywordflow">break</span>;
<a name="l00092"></a>00092             <span class="keywordflow">case</span> <span class="stringliteral">&#39;csv&#39;</span> : header(<span class="stringliteral">&#39;Content-Type: application/csv; charset=UTF-8&#39;</span>); <span class="keywordflow">break</span>;
<a name="l00093"></a>00093             <span class="keywordflow">case</span> <span class="stringliteral">&#39;xml&#39;</span> : header(<span class="stringliteral">&#39;Content-Type: text/xml; charset=UTF-8&#39;</span>); <span class="keywordflow">break</span>;
<a name="l00094"></a>00094             <span class="keywordflow">case</span> <span class="stringliteral">&#39;text&#39;</span>: header(<span class="stringliteral">&#39;Content-Type: text/plain; charset=UTF-8&#39;</span>); <span class="keywordflow">break</span>;
<a name="l00095"></a>00095             <span class="keywordflow">default</span>: <span class="keywordflow">throw</span> <span class="keyword">new</span> RuntimeException(<span class="stringliteral">&quot;Format $output_format not recognized&quot;</span>);
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098     
<a name="l00104"></a><a class="code" href="class_view_manager.html#a1a7c10628375ee4deb4d6e5a88176ec6">00104</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#a1a7c10628375ee4deb4d6e5a88176ec6">setConfig</a> ($configuration = array()) {
<a name="l00105"></a>00105         $default = array(
<a name="l00106"></a>00106             <span class="stringliteral">&#39;default_output_format&#39;</span> =&gt; <span class="stringliteral">&#39;html&#39;</span>,
<a name="l00107"></a>00107             <span class="stringliteral">&#39;default_view_path&#39;</span> =&gt; dirname(dirname(__FILE__)) . <span class="stringliteral">&quot;/application/view&quot;</span>,
<a name="l00108"></a>00108             <span class="stringliteral">&#39;view_path&#39;</span> =&gt; dirname(dirname(__FILE__)) . <span class="stringliteral">&quot;/application/view/&quot;</span>,
<a name="l00109"></a>00109             <span class="stringliteral">&#39;layout_file&#39;</span> =&gt; <span class="stringliteral">&#39;default&#39;</span>,
<a name="l00110"></a>00110             <span class="stringliteral">&#39;layout_content_var&#39;</span> =&gt; <span class="stringliteral">&#39;page_content&#39;</span>,
<a name="l00111"></a>00111         );
<a name="l00112"></a>00112         self::$_config = array_merge($default, $configuration);
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114     
<a name="l00120"></a><a class="code" href="class_view_manager.html#ac22b2cdf91e4a9e6650ee990556fc478">00120</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#ac22b2cdf91e4a9e6650ee990556fc478">setLayoutFile</a> ($file) {
<a name="l00121"></a>00121         self::$_config[<span class="stringliteral">&#39;layout_file&#39;</span>] = $file;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123     
<a name="l00128"></a><a class="code" href="class_view_manager.html#ab4ddb76e22cf9c96cd60b794aee9d1da">00128</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#ab4ddb76e22cf9c96cd60b794aee9d1da">getLayoutFilePath</a> ($format = <span class="stringliteral">&quot;html&quot;</span>) {
<a name="l00129"></a>00129         <span class="keywordflow">return</span> dirname(dirname(__FILE__)) . <span class="stringliteral">&quot;/application/view/layouts/&quot;</span> . self::$_config[<span class="stringliteral">&#39;layout_file&#39;</span>] . <span class="stringliteral">&quot;.{$format}.php&quot;</span>;
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     
<a name="l00137"></a><a class="code" href="class_view_manager.html#aa38a3875aace56cdf8d63212f61ae7bf">00137</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#aa38a3875aace56cdf8d63212f61ae7bf">addLayoutVars</a> ($collection) {
<a name="l00138"></a>00138         <span class="keywordflow">if</span> (!empty($collection))
<a name="l00139"></a>00139             self::$_layout_vars = array_merge(self::$_layout_vars, (array)$collection);
<a name="l00140"></a>00140     }
<a name="l00141"></a>00141     
<a name="l00146"></a><a class="code" href="class_view_manager.html#a584d49c99d8829331ec72c22a1fc6485">00146</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#a584d49c99d8829331ec72c22a1fc6485">getLayoutVars</a> () {
<a name="l00147"></a>00147         <span class="keywordflow">return</span> self::$_layout_vars;
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149     
<a name="l00155"></a><a class="code" href="class_view_manager.html#ab1a5760990649dd0b2c8252675e1faf6">00155</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#ab1a5760990649dd0b2c8252675e1faf6">getLayoutVar</a> ($key) {
<a name="l00156"></a>00156         <span class="keywordflow">return</span> isset(self::$_layout_vars[$key]) ? self::$_layout_vars[$key] : null;
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158     
<a name="l00165"></a><a class="code" href="class_view_manager.html#abaf6cccf5b025c4c04242c35120286e6">00165</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#abaf6cccf5b025c4c04242c35120286e6">setLayoutVar</a> ($key, $value) {
<a name="l00166"></a>00166         self::$_layout_vars[$key] = $value;
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168     
<a name="l00169"></a><a class="code" href="class_view_manager.html#ad9832e7ccb25f7f79b02179d60853624">00169</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#ad9832e7ccb25f7f79b02179d60853624">setViewPath</a> ($path) {
<a name="l00170"></a>00170         <span class="keywordflow">if</span> (file_exists($path)) {
<a name="l00171"></a>00171             self::$_config[<span class="stringliteral">&#39;view_path&#39;</span>] = $path;
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173         <span class="keywordflow">else</span>
<a name="l00174"></a>00174             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_missing_file_exception.html">MissingFileException</a>($path);
<a name="l00175"></a>00175     }
<a name="l00176"></a>00176     
<a name="l00182"></a><a class="code" href="class_view_manager.html#afbd79584ae0638d18d85a21bf70f3076">00182</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#afbd79584ae0638d18d85a21bf70f3076">setResponse</a> (<a class="code" href="class_response.html">Response</a> &amp;$response) {
<a name="l00183"></a>00183         self::$_response = $response;
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185     
<a name="l00192"></a><a class="code" href="class_view_manager.html#ac893e0be0c4045ba856873af3706fb4a">00192</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_view_manager.html#ac893e0be0c4045ba856873af3706fb4a">redirect</a> ($url) {
<a name="l00193"></a>00193         header(<span class="stringliteral">&quot;Location: $url&quot;</span>);
<a name="l00194"></a>00194         <span class="comment">/*</span>
<a name="l00195"></a>00195 <span class="comment">         * TODO add redirection message here</span>
<a name="l00196"></a>00196 <span class="comment">        self::setLayoutVar(&#39;url&#39;, $url);</span>
<a name="l00197"></a>00197 <span class="comment">        self::load(&quot;ErrorController&quot;, &quot;redirection&quot;);</span>
<a name="l00198"></a>00198 <span class="comment">         */</span>
<a name="l00199"></a>00199         exit();
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00207"></a><a class="code" href="_view_manager_8class_8php.html#acea4248a073af4582d5069babd4656b2">00207</a> function <a class="code" href="_view_manager_8class_8php.html#acea4248a073af4582d5069babd4656b2">redirect</a> ($url) {
<a name="l00208"></a>00208     <a class="code" href="class_view_manager.html#ac893e0be0c4045ba856873af3706fb4a">ViewManager::redirect</a>($url);
<a name="l00209"></a>00209 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Jul 28 09:58:10 2011 for Axiom by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
